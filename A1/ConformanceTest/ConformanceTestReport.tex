\documentclass[ieee]{submit}

\title{State-Based Testing}
\date{2015-10-05}
\author{
	\MakeUppercase{Neil Edelman}
	\affil{McGill University (110121860)}
	\MakeUppercase{Casimir D\'esarmeaux}
	\affil{McGill University (260467441)}
}
\setinfo[A1]{N. Edelman, C. D\'esarmeaux}{\thetitle}{304}{429}{001}{Fall}{2015}

\begin{document}

\category{D.1.3}{Software}{Concurrent Programming}
\terms{Software}
\keywords{Subject}

\begin{abstract}
Assignment 1 report.
\end{abstract}

\maketitle

\course{Prof. G. Mussbacher}{ECSE 429 -- Introduction to Software Quality Assurance}

\clearpage
\pagenumbering{roman}

\tableofcontents

%\hr

%\listoffigures

\clearpage
\pagenumbering{arabic}

\section{Source Code}

\subsection{Source code}

\begin{quote}
The source code that generates the test class for the CCoinBox example given the state
machine definition and implementation of the state machine.
\end{quote}

The code is in the {\tt package ca.mcgill.ecse429.conformancetest.nplus}.

\subsection{Generated code}

\begin{quote}
The result of the test class generation for the CCoinBox example without any manual changes
after generation. This class must be called GeneratedTestCCoinBox.java and saved in the same package as the implementation of the state machine.
\end{quote}

The generated code is in {\tt test}, following the same directory structure.

\section{Complete Test Class}

\begin{quote}
The complete test class for the CCoinBox example with additional code added manually asneeded to fully test the CCoinBox state machine based on the N+ Test Strategy (conformance tests only). This class must be called TestCCoinBox.java and saved in the same package as the implementation of the state machine. Any manual changes have to be clearly identified in thecomplete test class. Any complete test class that cannot be executed as a JUnit test will result in a mark of 0 for this part.
\end{quote}

The generated code is in {\tt test}, following the same directory structure.

\section{Report}

\subsection{Description}

\begin{quote}
Describe how to run your source code to generate the test class for a given state machine (xml file) and corresponding implementation of the state machine. This description should work for the CCoinBox example but also for the unknown state machine and its implementation.
\end{quote}

From the root of the project,

{\tt java -cp bin:lib/xmlpull-1.1.3.1.jar:lib/xpp3\_min-1.1.4c.jar:lib/xstream-1.4.7.jar ca/mcgill/ecse429/conformancetest/nplus/Nplus <xmlfile>}

For example,

{\tt java -cp bin:lib/xmlpull-1.1.3.1.jar:lib/xpp3\_min-1.1.4c.jar:lib/xstream-1.4.7.jar ca/mcgill/ecse429/conformancetest/nplus/Nplus ccoinbox.xml > test/ca/mcgill/ecse429/conformancetest/ccoinbox/GeneratedTestCCoinBox.java}

To add this to the Makefile, add another entry to the variable XML,

{\tt <xml file>:<path to java>}

Eg,

{\tt legislation.xml:ca/mcgill/ecse429/conformancetest/legislation/Legislation.java}

You will have to set {\tt JUNITHOME} in your environment.

You can also work with Eclipse.

\subsection{Manual changes}

\begin{quote}
In a few paragraphs, discuss which manual changes you had to make to the generated test class to get the complete test class and why you had to make those manual changes instead of automatically generating the test code.
\end{quote}

In order to make a complete test for the CCoinBox example, some manual code had to be added to the test class automatically generated. For every test case generated by the automated code, an instance of the test object was already created. At every creation of test objects, the constructor was first tested, which consists in making sure that the totalQuarters and curQuarters variables were set to 0, and that the allowVend boolean was set to false. 
As the exploration of the path carries on, the variables that were modified after every event applied on the test object. For the CCoinBox example, the incrementation of the current quarters after the addQtr() event was tested, as well as the decrease of the current quarters by 2 and increase of totalQuarters by 2 after every vend() event. Similarly, after every reset() and returnQtrs() event applied, the setting of current quarters back to 0 was also tested.

\subsection{Defects}

\begin{quote}
In one paragraph, describe whether you found any defects in the implementation of the CCoinBox example. For each found defect, describe how you fixed it.
\end{quote}

Some test cases generated by the the Nplus.java class also lead to failure. Indeed, when the CCoinBox would reach the state ‘allowed’, it would then lead to 6 possibilities in the round trip path tree, but 3 of the 6 cases would fail. 

\begin{itemize}
\item Allowed $\rightarrow$ addQtrs() $\rightarrow$ allowed: the condition where a state is allowed and the addQtr() event is applied should lead to another allowed state, however the CCoinBox.java implementation changes the state to notAllowed. To fix this issue, the CCoinBox.java has been modified so the it would keep the state to allowed
\item Allowed $\rightarrow$ vend() $\rightarrow$ allowed: this is because the round trip path tree goes through 2 steps before reaching this one (empty$\rightarrow$notAllowed$\rightarrow$allowed). In these 2 steps, the addQtr() event is used as a transition, meaning that the count of current quarters when the allowed state is reached is 2. However, in order to go from an allowed state to another allowed state after the vend() event is applied, the current quarter count has to be 4. This cannot be done automatically, and has been fixed by using the setCurQtr(int) method, setting the current quarter count to 4 before the vend() event is applied
\item Allowed $\rightarrow$ vend() $\rightarrow$ notAllowed: this is the same scenario as above, with one difference. In order to reach a notAllowed state, the current quarter count has to be 3, so that 1 quarter remains, which is conform the notAllowed state.
\end{itemize}


\subsection{Conformance}

\begin{quote}
In one paragraph, discuss what would be the main challenge to automate the generation of sneak path test cases from a given state machine conforming to the metamodel in Figure 1.
\end{quote}




The above scenarios had to be fixed manually, because the generated code respects the round trip path tree. In these cases, the code implementing the depth first search to make the round trip path tree could not catch these flaws. 

	As mentionned above, there was a defect found in the implementation of the CCoinBox example, which concerns the addQtr() method. The defect came from the case when the state is allowed, and when a quarter is added, it is changed to not allowed. This has been fixed by simply changing the outcome of the case: when the state is allowed and a quarter is added, the state remains allowed.

\received{\thedate}{\thedate}{\thedate}

\end{document}
